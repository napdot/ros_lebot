<html>
<head>
   <script type="text/javascript" src="http://brown-ros-pkg.googlecode.com/svn/tags/brown-ros-pkg/rosjs/ros.min.js"></script>
   <script language = "javascript" type = "text/javascript">
      var wsAddr = "ws://hostname:8080";
      var localAddr = "ws://localhost:9090";
      var topicName = "/referee"

      function init() {
         output = document.getElementById("output");
         initWebSocket();
         initRosConnection();
      }
      function initRosConnection(){
        rosconnection = new ros.Connection(localAddr);

        rosconnection.setOnOpen(function(e) {
          document.write('Connected to Ros<br/>')
        });
        rosconnection.setOnClose(function(e){
          document.write("Ros connection closed<br/>")
        });
        rosconnection.setOnError(function (e){
          document.write("Ros connection error<br/>")
        });
      }
      function initWebSocket() {
         websocket = new WebSocket(wsAddr);

         websocket.onopen = function(e) {
           document.write("Websocket connection open<br/>")
         };

         websocket.onmessage = function(e) {
            document.write("New websocket message<br/>")
           onMessage(e)
         };

         websocket.onerror = function(evt) {
           document.write("Websocket error<br/>")
         };
         websocket.onclose = function(evt) {
           document.write('Websocket closed<br/>')
         }
      }
      function onMessage(e) {
        var jsString = JSON.stringify(e);
        pubRos(jsString);
      }

      function pubRos(e) {
        rosconnection.publish('/referee', 'std_msgs/String', e);
        document.write("Publish to topic " + topicName + " successfully<br/>")
      }

   </script>
   </head>
<body onload="init()">
<div id = "output"></div>
</body>
</html>