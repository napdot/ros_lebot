<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
<script type="text/javascript" type="text/javascript">
    var ros = new ROSLIB.Ros({
        url : "ws://localhost:9090"
    });
    ros.on('connection', function(){
        document.getElementById("status").innerHTML = "Connected";
    });
    ros.on('error', function(error){
        document.getElementById("status").innerHTML = "Error:";
    });
    ros.on('close', function() {
        document.getElementById("status").innerHTML = "Closed";
     });

    var refTopic = new ROSLIB.Topic({
      ros: ros,
      name: '/referee',
      messageType: 'std_msgs/String'
    });

    websocket = new WebSocket(wsAddr);
    websocket.onopen = function(e) {
        document.getElementById("action").innerHTML = 'Websocket connection open'
    };
    websocket.addEventListener('Message', function(e) {
        document.getElementById("action").innerHTML = 'New websocket message'
        onMessage(e.data)
    });
    websocket.onerror = function(e) {
        document.getElementById("action").innerHTML = 'Websocket error'
    };
    websocket.onclose = function(e) {
        document.getElementById("action").innerHTML = 'Websocket closed'
    }

    function onMessage(e) {
        let jsString = JSON.stringify(e);
        pubRos(jsString);
    }

    function pubRos(e) {
        let RefMessage = new ROSLIB.Message({
            data : e});
        refTopic.publish(RefMessage);
        document.getElementById("msg").innerHTML = e.data;
      }

</script>
</head>

<body>
  <h1>Lebot</h1>
  <p>Connection status: <span id="status"></span></p>
  <p>Last messaged published: <span id="msg"></span></p>
  <p><span id="action"></span></p>
</body>
</html>